# Firefox + NVDA 2025 系 / 2026 系 読み上げ比較手順

対象記事: [_posts/2026-02-15-nvda-zero-size-controls-browse-mode.md](../_posts/2026-02-15-nvda-zero-size-controls-browse-mode.md)  
目的: **Firefox** で同じページを開き、**NVDA 2025 系**と**NVDA 2026 系**のブラウズモード読み上げを比較する。

※ 検証の前後では [chrome-nvda-verification](../.cursor/rules/chrome-nvda-verification.mdc) の「フォーカスをブラウザに移す」「ブラウズモード確認」「アドレスバーにいるときだけ本文へ」を必ず行う。**本手順は Firefox のみ**を想定する。

---

## 0. Jekyll サーバー起動（WSL2）

ローカルで記事を表示して検証する場合は、**Jekyll サーバーを WSL2 で起動する**。

- **前提**
  - `bundle install` と **`npm i` は済んでいる**（別途 [README の手順](../README.md) で実施済みとする）。
- **起動手順**
  1. WSL2 のターミナル（Ubuntu など）を開く。
  2. プロジェクトのルートに移動する（例: `cd /mnt/c/shuaruta/ARIA-Barriers`）。
  3. 次を実行する。
     ```bash
     bundle exec jekyll serve --host 0.0.0.0
     ```
  4. ターミナルに `Server address: http://127.0.0.1:4000` や `done in ...` が出てサーバーが立ち上がったら、Windows 側で **C:\Program Files\Mozilla Firefox\firefox.exe** を起動し、**http://localhost:4000** を開く。
- **記事の URL（ローカルで使う固定 URL）**
  - **http://localhost:4000/2026/02/15/nvda-zero-size-controls-browse-mode.html**  
  （本番で検証する場合はデプロイ済みの当該記事 URL を使う。その場合は 0. は不要。）

サーバーは検証中ずっと起動したままにしておく。

---

## 1. 準備

- **環境**
  - **同一マシンで 2 回検証する場合:** 1 回目は 2025 系ポータブル（`c:\nvda\portables\2025.3.2jp\nvda.exe`）を起動して検証。終了後、2026 系ポータブル（`c:\nvda\portables\betajp\nvda.exe`）を起動して 2 回目を検証する。
  - **2 台で検証する場合:** それぞれのマシンで同じ記事 URL を開く。
- **記事 URL**
  - **ローカル:** 0. を実行したうえで **http://localhost:4000/2026/02/15/nvda-zero-size-controls-browse-mode.html** を開く。
  - **本番:** 0. は行わず、デプロイ済みの当該記事の URL を開く。
- **ブラウザ**
  - **Firefox** のみ。記事本文にも「Firefox のブラウズモード（gecko_ia2）」とある。
  - 実行ファイル: **C:\Program Files\Mozilla Firefox\firefox.exe**
- **NVDA バージョン確認**
  - 検証開始前に、NVDA メニュー「ヘルプ」→「NVDA のバージョン情報」でバージョンを確認し、2025.x か 2026.x かを記録する。
- **NVDA のポータブル版**
  - **2025 系:** **c:\nvda\portables\2025.3.2jp\nvda.exe**
  - **2026 系（ベータ）:** **c:\nvda\portables\betajp\nvda.exe**（2026.1 系ベータ）。各バージョンの検証時は、対応するポータブルから起動する。

---

## 2. 共通の事前手順（毎回）

**作業の途中で人間が Cursor に指示を出すと、フォーカスが Cursor に移る。** 人間から指示を受けたら、**毎回** 次を行うこと。

- **フォーカスをブラウザに戻す**（下記手順 1）
- **コンテンツに移動し直す**（アドレスバーにいる場合は shift+f6 で本文へ。手順 3）
- **ブラウズモードであることを再確認する**（手順 2）

つまり、指示を受けたたびに **手順 1 から順にやり直し**、手順 4 まで済ませてから検証（3. 読み上げ取得）を続ける。

---

### Firefox を起動して記事を開いた直後（該当する場合）

Firefox を起動した直後、または記事を開く操作を行うときは、次を実行してから下記手順 1 以降に進む。

1. **モーダルが表示されている場合**  
   「閉じる」ボタンや「続ける」ボタンを探して押し、モーダルを閉じる。
2. **Ctrl+L** でアドレスバーに移動する。
3. 記事の URL（例: `http://localhost:4000/2026/02/15/nvda-zero-size-controls-browse-mode.html`）を入力して **Enter** を押す。
4. コンテンツの読み込みが完了したことを確認する。
5. **Ctrl+L** でアドレスバーに再度フォーカスし、**Tab** を 3 回程度押してコンテンツ領域に移動する。コンテンツに入ったことを確認する。
6. 以上が済んだら、下記**手順 1**（フォーカスを Firefox に移す）以降の検証作業を始める。

（すでに Firefox で記事を開いていて、別アプリから戻ってきただけの場合は、手順 1 から行えばよい。）

---

1. **フォーカスを Firefox に移す**  
   `insert+t` を送り、`get_speech_history` または `get_last_speech` でウィンドウ名を取得する。取得した文字列の**末尾**に **Firefox** が含まれていなければ、`alt+tab` を 1 回送ってから再度 `insert+t` で確認する。末尾に Firefox が含まれるまでこれを繰り返す（通常は 1〜数回で切り替わる）。

2. **ブラウズモードにする**  
   **insert+space** を 1 回送り、`get_speech_history` で読み上げを取得する。「**ブラウズモード**」と読まれていれば OK。「**フォーカスモード**」と読まれた場合は、**insert+space** をあと 1 回送り、再度 `get_speech_history` で「ブラウズモード」になることを確認する。

3. **アドレスバーにいるときだけ本文へ**  
   いきなり **shift+f6** は送らない（本文にいるときに送るとアドレスバーに移ってしまう）。  
   **clear_speech_history** → **ctrl+home** → **下矢印を 1 回**送る → **get_speech_history** で読み上げを取得する。1 回で判然としない場合は、下矢印をあと 1〜2 回送って再度 get_speech_history で確認する。  
   取得結果が「ナビゲーション ツールバー」「URL を入力」「Firefox Suggest」「○の1」のいずれか、またはアドレスバー・サジェストと分かる内容なら、**shift+f6** を 1 回送って本文に移し、**手順 2 からやり直す**。上記以外（記事の見出しや本文の文言など）なら本文にいるので**手順 4 へ**。

4. **ページ先頭から下矢印で進める状態にする**  
   `clear_speech_history` を実行したあと、**ctrl+home** を 1 回送る。ここから「3. 読み上げ取得」へ進む。

---

## 3. 読み上げ取得（各 NVDA バージョンで同じ手順）

いずれも **ブラウズモード** のまま、**下矢印**で仮想バッファを進め、指定箇所の読み上げを取得する。

### 3.1 デモ1: 幅0・高さ0のラジオボタン

- **到達の目安:** 手順 4 のあと、**下矢印を 20 回**送る → `get_speech_history` で読み上げを取得する。「メンテナンスドローンを選択」「オプション A」などが含まれていればデモ1付近。含まれていなければ、**下矢印をあと 10 回**送って再度 `get_speech_history` で確認する（サイトのヘッダー長により 25〜40 回程度になることがある）。
- **確認すること**
  - 「オプション A」「オプション B」「オプション C」が**ラジオ**として読まれるか。
  - ラジオとして選択（Space 等）できるか。
- **記録:** 該当付近で `get_speech_history` の結果を表に記入する。

| 項目 | NVDA 2025 系 | NVDA 2026 系 |
|------|----------------|----------------|
| ラジオ「オプション A/B/C」が読まれたか | 「読まれた」／「飛ばされた」／「読まれなかった」のいずれか | 同上 |
| 備考 | 実際の読み上げ文言や「フォーカスモードでのみ読めた」など | 同上 |

### 3.2 デモ2: 「名前を入力する」ボタン

- **到達の目安:** デモ1のラジオ 3 つ（オプション A/B/C）を過ぎたあと、**下矢印を 5〜15 回**送り、都度 `get_speech_history` で確認する。「名前を入力する」「ボタン」が含まれた時点でデモ2付近。
- **確認すること**
  - 「名前を入力する」ボタンがブラウズモードで読まれるか。
  - 該当要素にフォーカスがある状態で **Enter** を押すと、「名前を入力する」ボタンが押された旨のメッセージ（アラート）が出る。
- **記録:** 該当付近で `get_speech_history` の結果を表に記入する。

| 項目 | NVDA 2025 系 | NVDA 2026 系 |
|------|----------------|----------------|
| 「名前を入力する」ボタンが読まれたか | 「読まれた」／「飛ばされた」／「読まれなかった」のいずれか | 同上 |
| 備考 | 実際の読み上げ文言など | 同上 |

### 3.3 デモ3: 値が 0 のプログレスバー（幅0）

- **到達の目安:** デモ2の「名前を入力する」ボタンを過ぎたあと、**下矢印を 5〜15 回**送り、都度 `get_speech_history` で確認する。「読み込み中」「プログレス」「0%」のいずれかが含まれた時点でデモ3付近。
- **確認すること**
  - プログレスバーが「0%」などと読まれるか。
- **記録:** 該当付近で `get_speech_history` の結果を表に記入する。

| 項目 | NVDA 2025 系 | NVDA 2026 系 |
|------|----------------|----------------|
| プログレスバー（0%）が読まれたか | 「読まれた」／「飛ばされた」／「読まれなかった」のいずれか | 同上 |
| 備考 | 実際の読み上げ文言など | 同上 |

---

## 4. 比較のポイント（記事の仕様に基づく）

- **NVDA 2026.1 以降**
  - 幅0・高さ0のコントロールを**非表示扱いしない**ため、上記 3 デモはいずれもブラウズモードで読め、操作できる想定。
- **NVDA 2025 系（2026.1 より前）**
  - 同じコントロールがブラウズモードの仮想バッファから**除外され、飛ばされる**ことがある。フォーカスモード（Tab でフォーカスを移す）では触れる可能性がある。

比較時は「**ブラウズモードのまま下矢印のみ**で各デモに到達し、期待どおり読めるか」を 2025 系と 2026 系で並べて記録する。フォーカスモード（Tab 移動）でしか読めない場合は「飛ばされた」扱いで備考に書く。

---

## 5. 実行順（2 バージョン比較する場合）

1. **2025 系の検証**
   - **c:\nvda\portables\2025.3.2jp\nvda.exe** を起動する。
   - **C:\Program Files\Mozilla Firefox\firefox.exe** で Firefox を起動し、記事 URL を開く。開く際は **2. 共通の事前手順** の「Firefox を起動して記事を開いた直後」に従う（モーダルを閉じる → Ctrl+L → URL 入力 → Enter → 読み込み確認 → Ctrl+L → Tab 3 回でコンテンツへ）。
2. 上記 **2. 共通の事前手順** を実行する（手順 1 のフォーカス確認から）。
3. **3. 読み上げ取得** に従い、デモ1・2・3 の読み上げを取得し、表の「NVDA 2025 系」列に記入する。
4. **2026 系の検証に切り替え**
   - **同一マシンの場合:** NVDA を終了し、**c:\nvda\portables\betajp\nvda.exe** を起動する。Firefox はそのまま使い、同じタブで **F5** で再読み込みするか、同じ URL を新しいタブで開いてもよい。
   - **別マシンの場合:** そのマシンで 2026 系ポータブルと Firefox を起動し、同じ記事 URL を開く（開く際は「Firefox を起動して記事を開いた直後」の手順に従う）。
5. **2. 共通の事前手順** を再度実行する（手順 1 のフォーカス確認から）。
6. **3. 読み上げ取得** に従い、デモ1・2・3 の読み上げを取得し、表の「NVDA 2026 系」列に記入する。
7. 表とメモをもとに、読み上げの有無・文言の違いをまとめる。

---

## 6. MCP 等で自動化する場合の注意

- 下矢印の回数はページ構成（ヘッダー・サイドバー・本文長）で変わるため、**固定回数ではなく「デモの見出しやラベルが get_speech_history に含まれるまで下矢印を続ける」**といったループにすると再現しやすい。
- キー送信は [chrome-nvda-verification](../.cursor/rules/chrome-nvda-verification.mdc) に従い、**insert+space**（または **caps+space**）でブラウズモード確認、**insert+t** でウィンドウ確認。Escape ・ Win+Tab は送らない。ウィンドウ切り替えは **alt+tab**。

以上が、Firefox + NVDA 2025 系と 2026 系で読み上げを比較する手順です。
