---
description: Chrome / Firefox + NVDA 検証時にフォーカスを確実にブラウザに戻す手順
alwaysApply: true
---

# Chrome / Firefox + NVDA 検証時のフォーカス確認

ユーザーが指示を出すとブラウザが非アクティブになりやすい。**Chrome または Firefox で記事を開いて NVDA の読み上げを検証する作業の前には、必ず次の手順を行うこと。**

## 検証実行プラン

1. **フォーカスをブラウザに移す**  
   **insert+t** を送り、`get_speech_history` / `get_last_speech` でウィンドウ名を取得。  
   **アプリ名は通常ウィンドウタイトルの末尾に読まれる**（例: 「… — Mozilla Firefox」の「Firefox」、「… - Google Chrome」の「Chrome」）。取得した文字列の末尾に **Firefox** または **Chrome** が含まれていればブラウザと判断する。そうでなければ **alt+tab** を送り、再度 **insert+t** で確認。ブラウザになるまで繰り返す。

2. **ブラウズモードにする**  
   **insert+space** を送り、`get_speech_history` で「**ブラウズモード**」が読まれたことを確認。  
   「フォーカスモード」のときはもう一度 **insert+space** を送る。

3. **アドレスバーにいるときだけ本文へ**  
   **shift+f6 / f6 は送らない。** まず **clear_speech_history** → **ctrl+home** → **下矢印**（複数回）→ **get_speech_history** で読み上げを取得。  
   取得結果がアドレスバー／サジェスト（下記「ブラウザ別の違い」参照）なら、**Firefox は shift+f6**、**Chrome は f6 を1回** 送って本文に移し、手順 2 からやり直す。

4. **記事読み上げの取得**  
   **clear_speech_history** → **ctrl+home** → **下矢印**（30〜40回、delayMs 120〜140）→ **get_speech_history** でデモ部分（ラジオ・ボタン・プログレスバー）の読み上げを確認。

※ **Escape** は送らない（スタートメニューが開くことがある）。ウィンドウ切り替えは **alt+tab** を優先し、届かない場合は **win+tab** も使える。

## 作業前に毎回

1. **ウィンドウの確認**  
   NVDA の「現在のウィンドウのタイトルを読み上げ」: **insert+t** を送り、`get_last_speech` で読み上げ結果を取得する。**アプリ名は通常タイトルの末尾に読まれる**（例: 「Firefox」「Chrome」）。

2. **ブラウザでない場合**  
   取得した文字列の末尾に **Firefox** または **Chrome** が含まれていなければ、**alt+tab** を送ってブラウザに切り替える。必要なら再度 **insert+t** で確認する。

3. **アドレスバーにフォーカスがある場合だけ本文へ移す**  
   **insert+t でウィンドウ確認した直後に shift+f6 / f6 を送らない。** Firefox で alt+tab 直後は既に本文にいることがある。shift+f6 を送ると本文→アドレスバーに移り、下矢印がサジェスト一覧を読んでしまう。  
   - まず **insert+space** でブラウズモードを確認し、**ctrl+home** → 下矢印 → **get_speech_history** で読み上げを取得する。  
   - 取得結果がアドレスバー／サジェスト（下記「ブラウザ別の違い」参照）のときだけ、**Firefox では shift+f6**、**Chrome では f6 を1回** 送って本文に移し、手順をやり直す。

4. **ブラウズモードの確認（必須）**  
   NVDA+スペース（ブラウズ/フォーカス切替）を送り、`get_speech_history` で読み上げを取得する。  
   - **送るキー:** NVDA Remote 仕様（`nvda_remote.md`  §11）に従い、**insert+space**（NVDA キーが Insert のとき）または **caps+space**（NVDA キーが Caps Lock のとき）を送る。被操作側の NVDA 設定と一致させる。  
   - 届かない場合は修飾キーとスペースの間に遅延を入れる（`send_keys` の `delayMs` など）か、**ins+space** を試す。  
   - 「**フォーカスモード**」と読まれていたら、もう一度同じキーを送り、再度読み上げを確認する。**フォーカスモードのまま下矢印を送るとスクロールになり、仮想バッファを読む検証にならない。**  
   - 「**ブラウズモード**」と読まれることを確認してからでないと、下矢印を送らない。  
   - ※ モード切替の「音で報告」をオフにしておくと、音声だけになるため `get_speech_history` で取得しやすい。  
   - いずれのキーでもモードが読み上げられない場合は、ユーザーに手動で NVDA+スペースを押してブラウズモードにしてもらってから検証を続ける。

5. **その後に**  
   読み上げ履歴のクリアと下矢印の送信で記事を読み進め、`get_speech_history` で検証する。

## ウィンドウ切り替え

- **alt+tab** で切り替え。届かない場合は **win+tab** でタスクビューを開き、矢印で「… — Mozilla Firefox」や「… - Google Chrome」を選んで **enter** で確定する。

## ブラウザ別の違い

- **アドレスバー→本文に移すキー**
  - **Firefox:** **shift+f6**（F6 だけだとアドレスバー→本文ではなく逆方向に動くため）。
  - **Chrome:** **f6 を1回**。
- **アドレスバー／サジェストと判断する読み上げの例**
  - **Firefox:** 「ナビゲーション ツールバー」「URL を入力」「Firefox Suggest」「○の1」など。
  - **Chrome:** アドレスバーやサジェスト関連の読み上げ（「○の1」など）。
- **Firefox の注意:** alt+tab で Firefox に戻した直後は、既に本文にフォーカスがあることが多い。その状態で shift+f6 を送ると本文→アドレスバーに移ってしまうので、先に下矢印で読み上げを確認してから、アドレスバーにいると判断したときだけ shift+f6 を送る。

## MCP のキー指定

- ブラウズ/フォーカス切替＋モード確認: **insert+space**（NVDA キーが Insert のとき）または **caps+space**（NVDA キーが Caps Lock のとき）。仕様上 `nvda+space` というキー名は使わず、被操作側の NVDA 設定に合わせる。ウィンドウのタイトル: **insert+t** / **ins+t**。
- ウィンドウ切り替えは **alt+tab** または **win+tab**。
- **Firefox** でアドレスバーにいる場合に本文へ: **shift+f6**。**Chrome** でアドレスバーにいる場合に本文へ: **f6 を1回**。
