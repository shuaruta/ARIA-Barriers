---
title: aria-live がうるさい
layout: default
---

この記事は[「アクセシビリティ Advent Calendar 2023」](https://adventar.org/calendars/8584) 22日目の記事です。

### お願い

このページは意図的に不適切に WAI-ARIA （Accessible Rich Internet Applications）技術を使って実装しています。
詳細は後述します。

閲覧に支障がある場合は GitHub で[この記事のMarkdown版](https://github.com/shuaruta/ARIA-Barriers/blob/main/_posts/2023-12-22-aria-live.md)をご利用ください。


### ARIA-Barriers とは

この記事を書いている [株式会社シュアルタ](https://www.shuaruta.com/) 代表の [nishimotz](https://d.nishimotz.com/aboutme) は、オープンソースのスクリーンリーダー [NVDA](https://www.nvaccess.org/) の [日本語版](https://www.nvda.jp/) を開発しています。

シュアルタは現在 [ACT Laboratory](https://actlab.org/) (Accessible Tools Laboratory) と定期的な技術交流を行っています。
ACT Laboratory はプログラミングを学ぶ視覚障害者の集まりです。高校生から20代までの若いメンバーが集まって、ソフトウェアを開発・配布しています。

今回、シュアルタが ACT Laboratory メンバーの協力を得て、Webアクセシビリティ実装の失敗事例を発信するために、このサイトを作成しました。

### いま気になっていること

nishimotz は今年、[ウェブアクセシビリティ基盤委員会(WAIC)](https://waic.jp/)実装ワーキンググループの主査となり、「どのスクリーンリーダーにも対応できるウェブコンテンツ」を作るための情報整備に取り組みました。

ウェブサイトの制作案件にアクセシビリティチームとして関わったり、アクセシビリティ検証者を支援する教材作りをお手伝いする機会もいただきました。

この分野への関心の高まりをますます感じている中で、どうやら「本来は不要なWAI-ARIA」「間違って使われているWAI-ARIA」が増えている、と気づきました。

例えば NVDA ユーザーから、とあるウェブサイトに関する問題のご報告をいただいたのですが、Windows用の別のスクリーンリーダーであるナレーターでは再現しない、ということがありました。どうやら WAI-ARIA の使い方に問題があると見立てました。ですが、昨今のWebサイトは、単純そうに見えるものであっても、複雑にビルドされていることが多く、問題の原因を特定するのは容易ではありません。

このようなコンテンツが増えると「ARIA に対応できていないスクリーンリーダーの方が使いやすい」ということになりかねません。
技術の開発と啓発に関わる立場としては、とても困ったことです。

WAI-ARIA をこう使うとこんなひどいことになります、という実例をなるべくシンプルに作って説明しないと、開発者の方には伝わらないのではないか。

ACT Laboratory メンバーとこのような話をしていたら、「そういう実装にはよく遭遇しているので、パターン化できそう」「では紹介サイトを作ってみようか」ということになりました。

私が執筆するこの記事が第1号ですが、これから私以外の執筆者の記事も公開していく予定です。

### ライブリージョンの目的

2022年のアドベントカレンダーで、[スクリーンリーダーはどうやってライブリージョンを読み上げるのか](https://qiita.com/24motz/items/a992a8d3d4b65452b7eb)という記事を書いたきり、説明が途中で終わっているのですが、ライブリージョンの概要はそちらをご参照ください。

WCAG 2.1 の達成基準 4.1.3「ステータスメッセージ」は、
フォーカスを受けとらなくても支援技術によって利用者に提示できることを求めています。

* [達成基準 4.1.3: ステータスメッセージを理解する](https://waic.jp/translations/WCAG21/Understanding/status-messages.html)

実際に動くサンプルは下記にあります。

* [freee Accessibility Training ステータスメッセージ](https://freee.github.io/a11y-training/status-message/)

一方で、先ほどの「WCAG 2.1 解説書」には「失敗例」として

* Using role="alert" or aria-live="assertive" on content which is not important and time-sensitive

と（さらっと）書かれています。

これを「なるほどこれは失敗例だな」と感じていただくために作られたのがこのページです。

### この事例の解説

このページでは、`aria-live="assertive"` 属性を使用して、10秒ごとにコンテンツを更新する広告を実装しています。

視覚的には、このサイトは閲覧開始から10秒経過すると、一番下に黄色いバーが表示されます。このバーの中のメッセージは10秒ごとに
「今すぐダウンロード！あなたのPCを高速化！」
「限定オファー！無料で豪華ギフトをゲット！」
を交互に表示します。

スクリーンリーダーユーザーは、このサイトを上から順番に読み進めると、10秒ごとに読み上げが中断されて、広告の内容が読み上げられます。


```html
<div id="advertisement" aria-live="assertive">
</div>

<script>
document.addEventListener('DOMContentLoaded', (event) => {
    const messages = [
        '今すぐダウンロード！あなたのPCを高速化！',
        '限定オファー！無料で豪華ギフトをゲット！'
    ];
    let index = 0;
    const div = document.querySelector('#advertisement');

    setInterval(() => {
        div.textContent = messages[index];
        index = (index + 1) % messages.length;
    }, 10000);
});
</script>
```

### "role=alert" および "aria-live=assertive" の失敗例

`role="alert"` や `aria-live="assertive"` を重要でない、または時間に敏感でないコンテンツに使用することは、ARIA の役割とプロパティの誤用と考えられます。

1. **role="alert"**: この役割は重要で時間に敏感な情報のためのものです。`role="alert"` でマークされた要素は、支援技術によって直ちに内容が報告され、現在読まれている他のコンテンツが中断されます。これは、フォームのエラーメッセージや重要なステータス更新など、重要な情報に使用するべきです。

2. **aria-live="assertive"**: このプロパティは、ページのコンテンツが動的に更新される領域に使用されます。「assertive」という値は高い優先度レベルを意味し、この領域の変更は現在の音声出力を中断して新しいコンテンツを直ちに報告することを意味します。これは、警告メッセージや重要なステータスの変更など、ユーザーの即時の注意が必要なコンテンツに使用されます。

これらの属性を緊急性がなく、重要でないコンテンツに使用すると、スクリーンリーダーを使用するユーザーにとって不必要な中断や混乱を引き起こす可能性があります。それによって、より関連性の高いコンテンツよりも重要度の低い情報が優先され、ユーザーの体験を妨げ、重要な情報を見逃す可能性があります。

要約すると、`role="alert"` と `aria-live="assertive"` は、本当に重要で即時の注意が必要なコンテンツに限定して使用するべきです。これらのARIA役割とプロパティを誤用すると、支援技術に依存する人々にとってのウェブサイトのアクセシビリティと使いやすさに悪影響を与える可能性があります。


### おわりに

ひどいページを閲覧させてしまい、申し訳ありませんでした。

今後もひどいページを作って、アクセシビリティの失敗例を紹介していきますので、ご期待ください。


<!-- 以下はコンテンツ -->

<div id="advertisement" aria-live="assertive">
</div>

<script>
document.addEventListener('DOMContentLoaded', (event) => {
    const messages = [
        '今すぐダウンロード！あなたのPCを高速化！',
        '限定オファー！無料で豪華ギフトをゲット！'
    ];
    let index = 0;
    const div = document.querySelector('#advertisement');

    setInterval(() => {
        div.textContent = messages[index];
        index = (index + 1) % messages.length;
    }, 10000);
});
</script>

<style>
#advertisement {
   position: fixed;
   bottom: 0;
   z-index: 50;
   background-color: yellow;
}
</style>
