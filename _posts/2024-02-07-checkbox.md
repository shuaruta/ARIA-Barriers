---
title: 標準でないチェックボックスはいろいろ難しい
layout: default
---

この記事は[「アクセシビリティ Advent Calendar 2023」](https://adventar.org/calendars/8584) 22日目の記事です。[24motz](https://twitter.com/24motz) が執筆しました。





### みんな、標準のチェックボックスに不満を抱えている

普段からウェブサイトを閲覧している方であれば、以下のようなチェックボックスを一度は見たことがあるかと思います。
これは、HTMLのinput要素を用い、それ以上何の装飾や工夫もしていない、単純なチェックボックスです。
HTMLの標準要素なので、どのブラウザ、どのスクリーンリーダーでも支障なく利用することができるはずです。

<label><input type="checkbox">はい、見たことがあります></label>


しかし、世の中にはこの標準のチェックボックスを、「使いにくい」「アクセシビリティが低い」「そのまま使うべきでない」などという人がたくさんいます。
この記事を書いている私も、その一人だったりします。弱視の私には小さくて見えにくいのです。
様々な考えの人がいると思いますが、下記のようなことがよく言われます。

- 文字を大きくしても、チェックマークの大きさが変化しないので見えにくい、押しにくい(特にスマホ)
- チェックマークの色を変えたい
- 背景を白以外にしたい
- チェックマークの有無で背景色も変えたい
- チェックボックスとラベルに加え、もっと広範囲のクリックやタップに反応させたい

こういった理由で、「独自のチェックボックスを作りたい」という需要が生まれ、先人たちは様々なソリューションを生み出してきました。
そして、そこにはWAI-ARIAも無関係ではありません。

### CSSで改造されるチェックボックス

たとえば、「opacity:0」(不透明度0＝透明)を指定するなどの方法でチェックボックスを画面から隠してしまい、代わりにCSSを駆使して独自の描画を行う方法があります。
この手の改造方法であれば、アクセシビリティ上の悪影響は小さい場合が多いです。


### チェックボックスではないチェックボックス

クリック範囲の変更や細かな見た目の調整を行いたい場合などには、input要素に見切りをつけ、div要素やspan要素を用いてチェックボックスを作ってしまうという方法を選択されることがあります。
onClickイベントでチェックマークの有無を切り替えるということになるのですが、この方法で設置されるのは「見た目だけはチェックボックスっぽく見えるただの文字」にすぎません。
キーボードでの操作やスクリーンリーダーでの読み上げなど、様々な点で問題があります。

### 中途半端なWAI-ARIAの設定がもたらす結果

ここからが本題です。
WAI-ARIAの一つに、「role」という属性があります。
この属性を使うと、img要素で設置した画像でも、前節で出てきた「見た目だけはチェックボックスっぽく見えるただの文字」でも、果てはラジオボタンでさえも「チェックボックスである」と示すことができます。
要素に「role="checkbox"」を設定することで、どんな要素を使って作ったチェックボックスであっても、スクリーンリーダーは「チェックボックス」と認識します。

では、この「role="checkbox"」を設定することは、スクリーンリーダーユーザーに対するアクセシビリティ対応として適切なものでしょうか。
試しに、この設定を施した「div要素・アイコン・p要素を用いて作ったチェックボックス」を下に配置しておきます。

<div style="background-color: 333333;" role="checkbox">
	<!-- TODO: アイコンとスクリプトを入れてチェックボックスにする -->
	<p>チェック欄</p>
</div>

上のチェックボックスっぽいものにマウスを当てると、NVDAは「チェックボックス チェックなし チェック欄」と読み上げます。
意図したとおり、チェックボックスとして認識されています。
これだけを聞くと、何の問題もなさそうに見えます。
せっかちな人ならば「対応完了。リリース！」と言ってしまっても不思議ではありません。

### roleを設定しただけのチェックボックスは壊れている

下に、先ほどとほぼ同じチェックボックスがあります。
唯一の違いは、最初からチェック状態であるということです。

<div style="background-color: 333333;" role="checkbox">
	<!-- TODO: アイコンとスクリプトを入れてチェックボックスにする。こっちは初期値をチェック済みにしておく -->
	<p>チェック欄</p>
</div>

こちらにマウスを当てると、NVDAは「チェックボックス チェックなし チェック欄」と読み上げます。
チェック状態であるにもかかわらず、「チェックなし」と読み上げます。
これでは、正しく実装されたチェックボックスであるとは言えません。

この状態のチェックボックスは、下記のような問題を引き起こします。

- チェック状態のON/OFFを切り替えても適切に状態がフィードバックされず、意図した状態に設定できていることを確認する手段がない
- スクリーンリーダーのユーザーは「チェックボックスを操作してもチェックが入らない」という認識をするため、開発者に問い合わせをした場合に
  単に「スクリーンリーダーで正しく読み上げない」「チェックボックスをただの文字として認識している」という場合と比較して「アクセシビリティ対応の問題」であると認識されずらく、
  ユーザーの操作方法の理解不足等等として処理される場合がある
- 知識の浅いユーザーは、自身のPCやスクリーンリーダーの故障を疑ってしまう場合がある

### ARIAを完全実装しても、やはりまだ壊れている

[MDNによるARIA: checkbox ロールの説明ページ](https://developer.mozilla.org/ja/docs/Web/Accessibility/ARIA/Roles/checkbox_role)には、「role="checkbox" を含む要素には、チェックボックスの状態を支援技術に公開するための aria-checked 属性も含める必要があります。」という解説があります。
また、このあたりまで実装する開発者であれば、キーボード操作による切り替えへの考慮が漏れていたことにも気づくことでしょう。
前節までのものにaria-checked属性を適切に切り替える実装とキーボードのSpaceキーに反応する実装を追加して、下に設置しておきます。


これで、チェック状態に応じて適切に状態が読み上げられるようになりました。

しかし、上のチェックボックスはまだ壊れています。
TABキーで入力要素間を移動した際に、フォーカスされないという問題があります。
このままでは、フォームの入力体験として不便であるとともに、チェックボックスの存在に気づかないユーザーが出てしまうことになりかねません。


### まとめ

スクリーンリーダー利用者への対応として、「適切なroleを設定すればよい」という認識は、ほとんどの場合不十分、もしくは誤っています。
各roleには細かな使い方のルールや同時に組み合わせて使用する必要のある別の属性が存在するものが多くあります。
ARIA-ROLEを使用するのであれば、これらを熟知して適切に実装し、キーボードでの操作やスクリーンリーダーでの読み上げを入念にテストする必要があります。
知識、実装時間、テスト環境が必要ということです。
これらが十分でないのならば、ARIA-ROLEを使用するべきではありません。

この記事で示したように、中途半端なARIAの使用は、何もしていないサイト以上に厄介な存在となりかねません。
それを示すために書いたのが、この記事です。








